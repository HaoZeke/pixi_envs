[workspace]
authors = ["Rohit Goswami <rgoswami[at]ieee.org>"]
channels = ["conda-forge"]
name = "atomistic-cookbook"
platforms = ["linux-64"]
version = "0.1.0"

[tasks]

[dependencies]
nox = ">=2025.5.1,<2026"
pyyaml = ">=6.0.2,<7"
docutils = ">=0.21.2,<0.22"
# TODO(rg): Add this upstream, not in requirements.txt
requests = ">=2.32.4,<3"

[environments]
# There's basically one per file in atomistic-cookbook/examples
lpr = {features = ["lpr"]}
jup = {features = ["jup"]}

[feature.lpr.dependencies]
python = "==3.11"
pip = ">=25.1.1,<26"
ipykernel = ">=6.29.5,<7"

[feature.lpr.tasks.register-kernel]
# This one basically registers into jupyter Defined for each feature because the
# ipykernel needs to be the one in the folder's environment
cmd = """
python -m ipykernel install \
  --prefix "$(pixi r -e jup sh -c 'echo $CONDA_PREFIX')" \
  --name "pixi-$PIXI_ENVIRONMENT_NAME" \
  --display-name "Python (pixi-$PIXI_ENVIRONMENT_NAME)"
"""

[feature.lpr.pypi-dependencies]
ase = "==3.22.1"
matplotlib = ">=3.10.3, <4"
featomic = ">=0.6.1, <0.7"
skmatter = ">=0.3"

[feature.jup.dependencies]
jupyterlab = ">=4.4.5,<5"
jupytext = ">=1.17.2,<2"
sphinx-gallery = ">=0.19.0,<0.20"

[feature.jup.tasks.to-ipynb]
cwd = "atomistic-cookbook"
cmd = """
cp ../jupytext.toml . && \
jupytext examples/**/*.py \
         --to ipynb --from py:sphinx \
         --update
"""

[feature.jup.tasks.serve]
depends-on = [
{ task = "to-ipynb" },
{ task = "register-kernel", environment = "lpr" },
]
cwd = "atomistic-cookbook"
args = [ {"arg" = "port", "default" = "8889"} ]
cmd = """
jupyter lab --ServerApp.allow_remote_access=1 \
  --ServerApp.open_browser=False \
  --ContentsManager.allow_hidden=True \
  --port={{ port }}
"""
